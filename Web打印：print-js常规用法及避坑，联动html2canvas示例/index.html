<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>程序员玛丽的星海方舟 | Web打印：print.js常规用法及避坑，联动html2canvas示例</title><meta name="description" content="&lt;h2 id=&quot;一、print-js介绍：&quot;&gt;&lt;a href=&quot;#一、print-js介绍：&quot; class=&quot;headerlink&quot; title=&quot;一、print.js介绍：&quot;&gt;&lt;/a&gt;一、print.js介绍：&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://printjs.crabbly.com/&quot;&gt;print.js&lt;/a&gt;是一款开源的JavaScript依赖库，可以分析数据源，生成打印数据，然后调起浏览器的打印方法。支持pdf, html, image, json, raw-html格式。&lt;/p&gt;"><link rel="icon" href="https://cdn.jsdelivr.net/gh/MaryCLY/blog_cdn/source/images/物理2-飞船2.svg"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700"><link rel="stylesheet" href="/css/highlights/darkula.css"><link rel="stylesheet" href="/css/main.css"><link rel="search" type="application/opensearchdescription+xml" href="https://MaryCLY.github.io/atom.xml" title="程序员玛丽的星海方舟"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="程序员玛丽的星海方舟" type="application/atom+xml">
</head><body><div class="container"><header class="main-header"><h1 class="main-header__title uplize"><a class="main-header__title__link" href="/">程序员玛丽的星海方舟</a></h1><nav class="main-header__nav"><ul class="main-nav"><li class="main-nav__list"><a class="main-nav__list__link" href="/" target="_self">HOME</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/about/" target="_self">ABOUT</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/archives/" target="_self">ARCHIVE</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="https://github.com/maryCLY" target="_blank">GITHUB</a></li></ul></nav></header><main class="container__wrapper"><article class="article post"><h1 class="article__title">Web打印：print.js常规用法及避坑，联动html2canvas示例</h1><div class="article__date metadata"><div class="post-info">2024/11/21</div></div><div class="article__categories metadata">分类:
<a class="article__categories__link metadata" href="/categories/%E5%BC%80%E5%8F%91/">开发</a></div><div class="article__tags metadata">标签:
<a class="article__tags__link metadata" href="/tags/JS/">JS</a></div><div class="article__body"><h2 id="一、print-js介绍："><a href="#一、print-js介绍：" class="headerlink" title="一、print.js介绍："></a>一、print.js介绍：</h2><p><a target="_blank" rel="noopener" href="https://printjs.crabbly.com/">print.js</a>是一款开源的JavaScript依赖库，可以分析数据源，生成打印数据，然后调起浏览器的打印方法。支持pdf, html, image, json, raw-html格式。</p>
<span id="more"></span>

<h3 id="安装及使用方式："><a href="#安装及使用方式：" class="headerlink" title="安装及使用方式："></a>安装及使用方式：</h3><h4 id="1-node-npm"><a href="#1-node-npm" class="headerlink" title="1. node/npm"></a>1. node/npm</h4><p>使用npm或yarn安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install print-js --save</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add print-js</span><br></pre></td></tr></table></figure>

<p>导入及使用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> print <span class="keyword">from</span> <span class="string">&#x27;print-js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 基础用法 */</span></span><br><span class="line">print(printable, type)</span><br><span class="line"><span class="comment">// 如：print(&#x27;/test.pdf&#x27;, &#x27;pdf&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 进阶用法 */</span></span><br><span class="line">print(&#123;</span><br><span class="line">  ...options <span class="comment">// 配置项，见官方文档</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="2-html"><a href="#2-html" class="headerlink" title="2. html"></a>2. html</h4><p>cdn地址：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://printjs-4de6.kxcdn.com/print.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://printjs-4de6.kxcdn.com/print.min.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 默认暴露对象为printJS */</span></span><br><span class="line">printJS(printable, type)</span><br><span class="line">printJS(options)</span><br></pre></td></tr></table></figure>

<h2 id="二、常规使用案例："><a href="#二、常规使用案例：" class="headerlink" title="二、常规使用案例："></a>二、常规使用案例：</h2><p>此处介绍一个打印单页公文的示例。模拟Word文档的样式，A4尺寸（21cm*29.7cm），边距2cm。有标题、正文、页脚（时间）三个部分，间距为2cm。标题字体为宋体二号（22pt），正文字体为仿宋三号（16pt），行高均为1.75。</p>
<p>实际业务中需要先展示一个可编辑的预览页面，然后再提交打印，故选择使用print.js直接打印预览页面。</p>
<h3 id="实现代码："><a href="#实现代码：" class="headerlink" title="实现代码："></a>实现代码：</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">&quot;print_container&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">style</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">    position: relative;</span></span></span><br><span class="line"><span class="string"><span class="tag">    box-sizing: border-box;</span></span></span><br><span class="line"><span class="string"><span class="tag">    width: 21cm;</span></span></span><br><span class="line"><span class="string"><span class="tag">    height: 29.7cm;</span></span></span><br><span class="line"><span class="string"><span class="tag">    padding: 2cm;</span></span></span><br><span class="line"><span class="string"><span class="tag">    background: white;</span></span></span><br><span class="line"><span class="string"><span class="tag">    color: black;</span></span></span><br><span class="line"><span class="string"><span class="tag">  &quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&quot;font-family: &#x27;宋体&#x27;, serif; font-size: 22pt; text-align: center; margin-bottom: 2cm&quot;</span>&gt;</span>证<span class="symbol">&amp;nbsp;</span>明<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">      font-family: &#x27;仿宋&#x27;, serif;</span></span></span><br><span class="line"><span class="string"><span class="tag">      font-size: 16pt;</span></span></span><br><span class="line"><span class="string"><span class="tag">      line-height: 1.75;</span></span></span><br><span class="line"><span class="string"><span class="tag">      text-align: justify;</span></span></span><br><span class="line"><span class="string"><span class="tag">      text-indent: 2em;</span></span></span><br><span class="line"><span class="string"><span class="tag">      margin-bottom: 2cm;</span></span></span><br><span class="line"><span class="string"><span class="tag">    &quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      兹有xx，男性，汉族，身份证号码：xxxxxxxxxxxxxxxxxx，自2022年1月1日起居住在合肥市合肥高新技术产业开发区兴园社区服务中心梧桐社区，情况属实。</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>特此证明<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-family: &#x27;仿宋&#x27;, serif; font-size: 16pt; line-height: 1.75; text-align: right&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>2024年1月1日<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">print(&#123;</span><br><span class="line">  <span class="attr">printable</span>: <span class="string">&#x27;print_container&#x27;</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;html&#x27;</span>,</span><br><span class="line">  <span class="attr">targetStyles</span>: [<span class="string">&#x27;*&#x27;</span>],</span><br><span class="line">  <span class="attr">style</span>: <span class="string">&#x27;@media print&#123;@page &#123;margin: 0; size: a4&#125;&#125;&#x27;</span>,</span><br><span class="line">  <span class="attr">font</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">font_size</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="三、示例中的坑点解释，以及其他常见问题"><a href="#三、示例中的坑点解释，以及其他常见问题" class="headerlink" title="三、示例中的坑点解释，以及其他常见问题"></a>三、示例中的坑点解释，以及其他常见问题</h2><ol>
<li>建议使用印刷单位（如cm, pt）而非px来定义样式中的数值，避免打印时出现异常。</li>
<li>保证A4尺寸打印效果的关键：<br>(1) 定义容器的样式：<br>box-sizing: border-box; width: 21cm; height: 29.7cm; padding: 2cm.<br>(2) print配置中定义打印状态下的页样式：<br>style: &#39;@media print{@page {margin: 0; size: a4}}&#39;<br>这个设置可以让浏览器打印配置中的“边距”属性默认值为0，避免浏览器打印配置额外添加边距，导致内容出现偏移或缩小。</li>
<li>如果内容中的字体一致，可以直接在打印配置中设置font和font_size属性。<strong>否则一定要手动设置font_size属性为空值，不然所有的字体大小都会被强制覆盖为print.js设置的默认值。</strong></li>
<li>多页打印时的分页问题<br>通常的解决方法是在每页的最后一个元素样式中设置page-break-after: always.</li>
</ol>
<p>如果读者还有其他问题的解决经验，可以在评论区补充~</p>
<h2 id="四、使用html2canvas打印网页快照"><a href="#四、使用html2canvas打印网页快照" class="headerlink" title="四、使用html2canvas打印网页快照"></a>四、使用html2canvas打印网页快照</h2><p>有时由于网页时效性较强，或是跨域等问题难解决，需要使用html2canvas之类的快照工具来保存实时内容，然后进行打印。</p>
<p>以下将介绍一个打印网页快照（多页）的案例。</p>
<h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;page&quot;</span>&gt;</span>第1页内容<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;page&quot;</span>&gt;</span>第2页内容<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> html2canvas <span class="keyword">from</span> <span class="string">&#x27;html2canvas&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> print <span class="keyword">from</span> <span class="string">&#x27;print-js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pageList = <span class="built_in">Array</span>.from(<span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;.page&#x27;</span>)); <span class="comment">// 获取每一页的元素</span></span><br><span class="line"><span class="built_in">Promise</span>.all(</span><br><span class="line">  pageList.map(<span class="function">(<span class="params">el</span>) =&gt;</span></span><br><span class="line">    html2canvas(el, &#123;</span><br><span class="line">      <span class="attr">useCORS</span>: <span class="literal">true</span>, <span class="comment">// 页面内含跨域内容的时候需要添加</span></span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">).then(<span class="function">(<span class="params">resList</span>) =&gt;</span> &#123;</span><br><span class="line">  print(&#123;</span><br><span class="line">    <span class="attr">printable</span>: resList.map(<span class="function">(<span class="params">res</span>) =&gt;</span> res.toDataURL()), <span class="comment">// 将canvas转换成base64</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;image&#x27;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="优化点"><a href="#优化点" class="headerlink" title="优化点"></a>优化点</h3><p>这样打印出来的结果可能会存在一定的失真，在html2canvas的参数中设置scale应该能有一定的优化。</p>
</div></article><div class="pagination"><a class="pagination__link pagination__next" href="/%E5%8F%8C%E7%89%88%E6%9C%AC%E5%BA%94%E7%94%A8%E9%87%8D%E6%9E%84%E5%90%8E%E7%9A%84%E6%84%9F%E6%83%B3/">下一篇</a></div></main><footer class="footer metadata"><p class="footer__text">© 2024 陈俪影</p><p class="footer__text">Powered by <a class="footer__text__link" href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a class="footer__text__link" href="https://pages.github.com/" target="_blank">Github Page</a></p></footer></div></body></html>